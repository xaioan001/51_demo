C51 COMPILER V9.60.0.0   STATEMACHINE                                                      09/18/2025 19:01:27 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE STATEMACHINE
OBJECT MODULE PLACED IN .\Objects\StateMachine.obj
COMPILER INVOKED BY: D:\work\KEIL\ARM\C51\BIN\C51.EXE APP\StateMachine.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.\APP;.\D
                    -RIVER;.\STC8HLib) DEBUG OBJECTEXTEND PRINT(.\Listings\StateMachine.lst) TABS(2) OBJECT(.\Objects\StateMachine.obj)

line level    source

   1          #include "type_def.h"
   2          #include "LCD_DISPLAY.h"
   3          #include "LCD_BASE.h"
   4          #include  "STC8H_RTC.h"
   5          #include "filtering.h"
   6          #include "Picture.h"
   7          #include "stdio.h"
   8          static u16 shi,fen,miao;
   9          extern float VAL;
  10          
  11          /**
  12          ***********************************************************
  13          * @brief   状态机获取状态
  14          * @param 
  15          * @return  实时状态序号
  16          ***********************************************************
  17          */
  18          u8 Getstate(u8 key,u16 VAL )
  19          {
  20   1        static u8 state=1,layer=1;//state:状态 layer:层数
  21   1      
  22   1        if((key==1)&&(layer==1))
  23   1          {
  24   2            state=state%3+1;//在第一到第三主界面下的第一层转换(s1,s2,s3)
  25   2            if(state==1)//状态1
  26   2            {
  27   3                Page_Content_1(YEAR,MONTH,DAY,HOUR,MIN,SEC,ALAHOUR,ALAMIN,ALASEC,VAL);          
  28   3            }
  29   2            else if(state==2)
  30   2            {
  31   3              LCD_Fill_Black(0,0,320,240);
  32   3              LCD_ShowPicture(100,50,IMG_HEIGHT,IMG_WIDTH,IMG_DATA);
  33   3            }
  34   2            else if(state==3)//状态3
  35   2              LCD_Fill_Black(0,0,320,240);
  36   2                
  37   2          }
  38   1        if((key == 44)&&(state!=5)&&(state!=6))
  39   1        {
  40   2          if(layer == 1)
  41   2          {
  42   3            state = 4;
  43   3            layer =2;
  44   3            LCD_Fill_Black(0,0,320,240); //清屏
  45   3          }
  46   2         if(layer == 2)
  47   2          {
  48   3            state = 4;
  49   3            layer =2;
  50   3            LCD_Fill_Black(0,0,320,240); //清屏
  51   3            Page_Content1_2();
  52   3          }
  53   2          
  54   2        }
C51 COMPILER V9.60.0.0   STATEMACHINE                                                      09/18/2025 19:01:27 PAGE 2   

  55   1        if((key==1)&&(layer == 2)&&(state == 4))
  56   1        {
  57   2          state=6;
  58   2        }
  59   1        if((key == 1)&&(layer == 2))
  60   1        {
  61   2          state = 11 - state;
  62   2        }
  63   1        if((key == 11)&&(layer == 2)&&(state == 5))
  64   1        {
  65   2          state=7;
  66   2          layer=3;
  67   2          LCD_Fill_Black(0,0,320,240);
  68   2          Page_Content1_2_3(state);//设置界面1 时间设置
  69   2          
  70   2        }
  71   1      
  72   1        if((key == 1)&&(layer == 3))
  73   1        {
  74   2          if(state == 7)
  75   2          {
  76   3            state=9;//年
  77   3          }
  78   2          else if(state == 9)
  79   2          {
  80   3            state=10;//月
  81   3          }
  82   2          else if(state == 10)
  83   2          {
  84   3            state=11;//日
  85   3          }
  86   2          else if(state == 11)
  87   2          {
  88   3            state=12;//时
  89   3          }
  90   2          else if(state == 12)
  91   2          {
  92   3            state=13;//分
  93   3          }
  94   2          else if(state == 13)
  95   2          {
  96   3            state=14;//秒 
  97   3          }
  98   2          else if(state==14)
  99   2          {
 100   3            state=9;
 101   3          }
 102   2          LCD_Fill_Black(0,0,320,240);
 103   2          Page_Content1_2_3(state);
 104   2        }
 105   1        if((key == 2)&&(layer == 3))//增加1
 106   1        {
 107   2          if(state==9)
 108   2          {
 109   3              INIYEAR = YEAR;
 110   3              INIYEAR++;
 111   3              RTCCFG |= 0x01;
 112   3          }
 113   2          else if(state==10)
 114   2          {
 115   3              INIMONTH = MONTH;
 116   3              INIMONTH++;
C51 COMPILER V9.60.0.0   STATEMACHINE                                                      09/18/2025 19:01:27 PAGE 3   

 117   3              RTCCFG |= 0x01;
 118   3          }
 119   2          else if(state==11)
 120   2          {
 121   3              INIDAY = DAY;
 122   3              INIDAY++;
 123   3              RTCCFG |= 0x01;
 124   3          }
 125   2          else if(state==12)
 126   2          {
 127   3              INIHOUR = HOUR;
 128   3              INIHOUR++;
 129   3              RTCCFG |= 0x01;
 130   3          }
 131   2          else if(state==13)
 132   2          {
 133   3              INIMIN = MIN;
 134   3              INIMIN++;
 135   3              RTCCFG |= 0x01;
 136   3          }
 137   2          else if(state==14)
 138   2          {
 139   3              INISEC = SEC;
 140   3              INISEC++;
 141   3              RTCCFG |= 0x01;
 142   3          }
 143   2        }
 144   1        if((key == 3)&&(layer == 3))//减少1
 145   1        {
 146   2          if(state==9)
 147   2          {
 148   3              INIYEAR = YEAR;
 149   3              INIYEAR--;
 150   3              RTCCFG |= 0x01;
 151   3          }
 152   2          else if(state==10)
 153   2          {
 154   3              INIMONTH = MONTH;
 155   3              INIMONTH--;
 156   3              RTCCFG |= 0x01;
 157   3          }
 158   2          else if(state==11)
 159   2          {
 160   3              INIDAY = DAY;
 161   3              INIDAY--;
 162   3              RTCCFG |= 0x01;
 163   3          }
 164   2          else if(state==12)
 165   2          {
 166   3              INIHOUR = HOUR;
 167   3              INIHOUR--;
 168   3              RTCCFG |= 0x01;
 169   3          }
 170   2          else if(state==13)
 171   2          {
 172   3              INIMIN = MIN;
 173   3              INIMIN--;
 174   3              RTCCFG |= 0x01;
 175   3          }
 176   2          else if(state==14)
 177   2          {
 178   3              INISEC = SEC;
C51 COMPILER V9.60.0.0   STATEMACHINE                                                      09/18/2025 19:01:27 PAGE 4   

 179   3              INISEC--;
 180   3              RTCCFG |= 0x01;
 181   3          }
 182   2        }
 183   1        if((key == 11)&&(layer == 2)&&(state == 6))
 184   1        {
 185   2          state=8;
 186   2          layer=3;
 187   2          LCD_Fill_Black(0,0,320,240);
 188   2          Page_Content1_2_3(state);//设置界面2 闹钟设置
 189   2          //printf("State6 = %bu,layer = %bu.\n",state,layer);
 190   2        }
 191   1        if((key == 11)&&(layer == 3)&&(state == 8))
 192   1        {
 193   2          state=15;
 194   2          layer=3;
 195   2          //Page_Content1_2_3(state);
 196   2        }
 197   1        if((key == 1)&&(layer == 3)&&((state>=15)&&(state<=18)))
 198   1        {
 199   2          if(state==15)
 200   2          {
 201   3            state=16;
 202   3            
 203   3          }
 204   2          else if(state==16)
 205   2          {
 206   3            state=17;
 207   3            
 208   3          }
 209   2          else if(state==17)
 210   2          {
 211   3            state=15;
 212   3            
 213   3          }
 214   2          Page_Content1_2_3(state);
 215   2        }
 216   1        if((key == 2)&&(layer == 3)&&(state==15))
 217   1        {
 218   2          ALAHOUR++;
 219   2        }
 220   1        if((key == 3)&&(layer == 3)&&(state==15))
 221   1        {
 222   2          ALAHOUR--;
 223   2        }
 224   1        if((key == 2)&&(layer == 3)&&(state==16))
 225   1        {
 226   2          ALAMIN++;
 227   2        }
 228   1        if((key == 3)&&(layer == 3)&&(state==16))
 229   1        {
 230   2          ALAMIN--;
 231   2        }
 232   1        if((key == 2)&&(layer == 3)&&(state==17))
 233   1        {
 234   2          ALASEC++;
 235   2        }
 236   1        if((key == 3)&&(layer == 3)&&(state==17))
 237   1        {
 238   2          ALASEC--;
 239   2        }
 240   1        if(((state==5)||(state==6))&&(key == 44)&&(layer == 2))
C51 COMPILER V9.60.0.0   STATEMACHINE                                                      09/18/2025 19:01:27 PAGE 5   

 241   1        {
 242   2          state=1;//从第二层返回第一层
 243   2          layer=1;
 244   2          LCD_Fill_Black(0,0,320,240);
 245   2          Page_Content_1(YEAR,MONTH,DAY,HOUR,MIN,SEC,ALAHOUR,ALAMIN,ALASEC,VAL);
 246   2        
 247   2        }
 248   1        if(((state==7)||(state==15))&&(key == 44)&&(layer == 3))
 249   1        {
 250   2          state=4;
 251   2          layer=2;
 252   2          LCD_Fill_Black(0,0,320,240);
 253   2          Page_Content1_2();
 254   2        }
 255   1        return state;
 256   1      }
 257          /**
 258          ***********************************************************
 259          * @brief   主状态机
 260          * @param 
 261          * @return  
 262          ***********************************************************
 263          */
 264          void StateMachine(u8 state,u8 key)
 265          {
 266   1        
 267   1        switch (state)
 268   1        {
 269   2          case 1:           //20          //24
 270   2            LCD_ShowIntNum(X_Position+110,Y_Position+60,HOUR,2,WHITE,RED,24);//状态1下显示时分秒 电压值，年月日
 271   2            LCD_ShowChar(X_Position+134,Y_Position+60,':',WHITE,RED,24,0);
 272   2            LCD_Fill(X_Position+134+12,Y_Position+60,X_Position+134+24,Y_Position+60+24,RED);//填充缺口
 273   2            
 274   2            LCD_ShowIntNum(X_Position+158,Y_Position+60,MIN,2,WHITE,RED,24);
 275   2            LCD_ShowChar(X_Position+182,Y_Position+60,':',WHITE,RED,24,0);
 276   2            LCD_Fill(X_Position+182+12,Y_Position+60,X_Position+182+24,Y_Position+60+24,RED);
 277   2            
 278   2            LCD_ShowIntNum(X_Position+206,Y_Position+60,SEC,2,WHITE,RED,24);//显示整数变量
 279   2            
 280   2            LCD_ShowFloatNum2(X_Position+110,Y_Position+156,VAL,3,WHITE,RED,24);
 281   2            break;
 282   2          case 2:
 283   2              LCD_ShowPicture(100,50,IMG_HEIGHT,IMG_WIDTH,IMG_DATA);
 284   2          printf("state = %bu.\n",state);
 285   2            break;
 286   2          case 3:
 287   2              LCD_Fill_Black(0,0,320,240);
 288   2            break;
 289   2          case 4:
 290   2            Page_Content1_2();
 291   2            break;
 292   2          case 5:
 293   2            Show_StringandChinese(X_Position+20,60, "设置页面1-时间设置",WHITE,RED,24,0);
 294   2            Show_StringandChinese(X_Position+20,150,"设置页面2-闹钟设置",WHITE,BLUE,24,0);
 295   2            break;
 296   2          case 6:
 297   2            Show_StringandChinese(X_Position+20,60, "设置页面1-时间设置",WHITE,BLUE,24,0);
 298   2            Show_StringandChinese(X_Position+20,150,"设置页面2-闹钟设置",WHITE,RED,24,0);
 299   2            break;
 300   2          case 7:
 301   2            Page_Content1_2_3(state);//时间设置页面
 302   2            break;
C51 COMPILER V9.60.0.0   STATEMACHINE                                                      09/18/2025 19:01:27 PAGE 6   

 303   2          case 8:
 304   2            Page_Content1_2_3(state);//闹钟设置页面
 305   2            break;
 306   2          case 9:
 307   2            Page_Content1_2_3(state);//年
 308   2            break;
 309   2          case 10:
 310   2            Page_Content1_2_3(state);//月
 311   2            break;
 312   2          case 11:
 313   2            Page_Content1_2_3(state);//日 
 314   2            break;
 315   2          case 12:
 316   2            Page_Content1_2_3(state);//时       
 317   2            break;
 318   2          case 13:
 319   2            Page_Content1_2_3(state);//分   
 320   2            break;
 321   2          case 14:
 322   2            Page_Content1_2_3(state);//秒       
 323   2            break;
 324   2          case 15: 
 325   2            Page_Content1_2_3(state);//闹钟设置  时
 326   2            break;
 327   2          case 16:
 328   2            Page_Content1_2_3(state);//分     
 329   2            break;
 330   2          case 17:
 331   2            Page_Content1_2_3(state);//秒
 332   2            break;
 333   2          case 18:
 334   2            Page_Content1_2_3(state);//秒->时   
 335   2            break;
 336   2          case 19:
 337   2            
 338   2            
 339   2            break;
 340   2          case 20: 
 341   2            break;
 342   2          
 343   2          default:
 344   2            break;
 345   2          
 346   2        }
 347   1      }
*** WARNING C280 IN LINE 264 OF APP\StateMachine.c: 'key': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2153    ----
   CONSTANT SIZE    =     52    ----
   XDATA SIZE       =      8       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
